<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Swiss & Milan 2026 | 數位行程表</title>
    <!-- Tailwind & FontAwesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'swiss-milan-2026';
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };
        initAuth();

        window.db = db;
        window.appId = appId;
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Serif+TC:wght@600&display=swap');
        :root { 
            --bg-base: #FDFCFB; 
            --accent-transport: #5B84B1; 
            --accent-spot: #D4A373; 
            --accent-hotel: #8E7B6D; 
        }
        body { 
            background-color: var(--bg-base); 
            color: #3D3D3D; 
            font-family: 'Noto Sans TC', sans-serif; 
            -webkit-font-smoothing: antialiased; 
            font-size: 19px; /* 字體進一步放大 */
        }
        .serif { font-family: 'Noto Serif TC', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .card { 
            background: white; 
            border-radius: 35px; 
            width: 100%; 
            margin-bottom: 15px; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.04); 
            border: 1px solid rgba(230, 225, 218, 0.7); 
        }
        
        .transport-card { background: #F8FAFC; border: 2px dashed var(--accent-transport); }
        .spot-card { border-bottom: 7px solid var(--accent-spot); }
        .hotel-card { border-left: 12px solid var(--accent-hotel); }
        
        .arrow-divider { 
            display: flex; justify-content: center; align-items: center; 
            height: 65px; color: #E2E8F0; font-size: 2.5rem; 
        }
        
        .day-btn { flex: 0 0 auto; width: 90px; height: 115px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 30px; transition: all 0.3s; background: transparent; }
        .day-btn.active { background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.12); color: var(--accent-transport); transform: translateY(-5px); border: 1px solid #E2E8F0; }
        
        .step-list-item { position: relative; padding-left: 45px; border-left: 4px solid #CBD5E1; margin-left: 15px; margin-bottom: 25px; }
        .step-list-item::before { content: ''; position: absolute; left: -10px; top: 12px; width: 16px; height: 16px; background: var(--accent-transport); border-radius: 50%; }
        
        input, textarea { background: #F9F9F9; border: 2px solid #E5E7EB; border-radius: 18px; padding: 15px; width: 100%; margin-top: 10px; font-size: 19px; }
        
        .text-detail { font-size: 20px; line-height: 1.8; }
        .text-title { font-size: 28px; font-weight: 700; }
        .nav-link-btn { color: var(--accent-transport); font-size: 1.1rem; font-weight: 700; background: #EFF6FF; padding: 8px 16px; border-radius: 15px; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen pb-32">

    <header class="sticky top-0 z-50 bg-[#FDFCFB]/95 backdrop-blur-md pt-10 pb-6 shadow-sm">
        <div class="px-6 mb-6 flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-extralight tracking-widest serif italic text-slate-700">The Archive.</h1>
                <p class="text-[14px] uppercase tracking-[0.4em] text-slate-400 mt-2 font-bold italic">2026 Swiss Journey</p>
            </div>
            <button id="edit-toggle" class="bg-slate-100 p-3 rounded-full text-slate-400 hover:text-emerald-500 transition shadow-sm">
                <i class="fas fa-edit text-2xl"></i>
            </button>
        </div>
        <div class="flex overflow-x-auto no-scrollbar gap-4 px-6 pb-2" id="date-navbar"></div>
    </header>

    <main class="px-6 mt-8" id="itinerary-content">
        <div class="flex flex-col justify-center items-center py-40 text-slate-300">
            <i class="fas fa-circle-notch animate-spin text-5xl mb-6"></i>
            <p class="text-xl">同步雲端行程中...</p>
        </div>
    </main>

    <!-- Save Button -->
    <button id="save-btn" class="hidden fixed bottom-12 right-8 bg-emerald-500 text-white w-20 h-20 rounded-full shadow-2xl z-[100] flex items-center justify-center text-3xl">
        <i class="fas fa-cloud-upload-alt"></i>
    </button>

    <script type="module">
        import { doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const defaultTripData = {
            days: [
                { day: 1, date: "3/18", weekday: "WED", title: "入境蘇黎世 ➔ 因特拉肯", cards: [
                    { type: "hotel", name: "出發：台灣機場", desc: "00:20 出發 EK0387 (Terminal 2)。準備開啟瑞士之旅！", img: "https://images.unsplash.com/photo-1542296332-2e4473faf563?auto=format&fit=crop&q=80" },
                    { type: "transport", name: "入境與鐵路移動", img: "https://images.unsplash.com/photo-1527668752968-14dc70a27c95?auto=format&fit=crop&q=80", steps: [
                        {mode: "飛機", route: "杜拜轉機 ➔ 12:25 抵達蘇黎世", time: "12hr+"},
                        {mode: "火車", route: "蘇黎世機場 ➔ Bern/Luzern ➔ 因特拉肯", time: "2hr"}
                    ], detail: "建議搭乘「盧塞恩-因特拉肯快線」欣賞景觀。持有 Swiss Pass 刷 QR Code 即可上車。" },
                    { type: "spot", name: "因特拉肯東站 Interlaken Ost", img: "https://images.unsplash.com/photo-1533512930330-4ac257c86793?auto=format&fit=crop&q=80", desc: "入飯店放行李。晚上在 Hohematte 大草地看滑翔傘降落。" },
                    { type: "hotel", name: "住：因特拉肯飯店", desc: "連住 5 晚的第一晚。調整時差、早點休息。", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80" }
                ]},
                { day: 2, date: "3/19", weekday: "THU", title: "少女峰：歐洲之巔全覽", cards: [
                    { type: "hotel", name: "起點：因特拉肯飯店", desc: "穿著保暖衣物，今日海拔超過 3400M。", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80" },
                    { type: "transport", name: "少女峰登山路線", img: "https://images.unsplash.com/photo-1531366930491-81529969ff3c?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車 R61", route: "東站 ➔ 格林德瓦轉運站", time: "35m"},
                        {mode: "快線纜車", route: "Eiger Express 艾格快線", time: "15m"},
                        {mode: "齒軌火車", route: "艾格冰河 ➔ 少女峰站", time: "25m"}
                    ], detail: "持 STP 購買此段票券有特別折扣。建議提早線上預約熱門時段座位。" },
                    { type: "spot", name: "斯芬克斯觀景台 / 阿萊奇冰川", img: "https://images.unsplash.com/photo-1541410965313-d53b3c16ef17?auto=format&fit=crop&q=80", desc: "11:00-14:00 拍攝重點：阿萊奇冰川、冰原平台、瑞士國旗。" },
                    { type: "transport", name: "返回飯店路程", img: "https://images.unsplash.com/photo-1549221195-23671f544521?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車 (回程)", route: "原路返回因特拉肯", time: "90m"}
                    ], detail: "下山可在格林德瓦小鎮稍作停留喝咖啡。" },
                    { type: "hotel", name: "終點：因特拉肯飯店", desc: "晚餐建議吃著名的瑞士起司火鍋。", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80" }
                ]},
                { day: 3, date: "3/20", weekday: "FRI", title: "First 倒影 ➔ 盧達本納", cards: [
                    { type: "hotel", name: "起點：因特拉肯飯店", desc: "今日步行為主，穿雙好走的鞋。", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80" },
                    { type: "transport", name: "前往 First 山頂", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車 R61", route: "Interlaken ➔ Grindelwald", time: "35m"},
                        {mode: "纜車", route: "Grindelwald ➔ First", time: "25m"}
                    ], detail: "抵達後健行至巴哈阿爾普湖 (Bachalpsee) 拍倒影。" },
                    { type: "spot", name: "巴哈阿爾普湖 Bachalpsee", img: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&q=80", desc: "雪山倒影最著名的地點。健行單程約 30-40 分鐘。" },
                    { type: "transport", name: "橫越瀑布谷路線", img: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車", route: "格林德瓦 ➔ 雙湖站 ➔ 盧達本納", time: "30m"}
                    ], detail: "轉乘銜接流暢，欣賞峽谷景觀。" },
                    { type: "spot", name: "施陶巴赫瀑布 Staubbach Falls", img: "https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?auto=format&fit=crop&q=80", desc: "15:30-17:30 瀑布谷逆光最美，猶如人間仙境。" },
                    { type: "hotel", name: "終點：因特拉肯飯店", desc: "休息。準備明日雪朗峰之旅。", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80" }
                ]},
                { day: 6, date: "3/23", weekday: "MON", title: "因特拉肯 ➔ 時尚米蘭", cards: [
                    { type: "hotel", name: "退房：因特拉肯飯店", desc: "檢查退房，前往東站移動。", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80" },
                    { type: "transport", name: "跨國鐵路路程", img: "https://images.unsplash.com/photo-1528150177508-7cc0c36cda5c?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車", route: "Interlaken ➔ Spiez", time: "20m"},
                        {mode: "火車 (EC)", route: "Spiez ➔ Milano Centrale", time: "3.5h"}
                    ], detail: "【重要】跨國段 EuroCity 必須劃位，建議一個月前訂好。" },
                    { type: "spot", name: "米蘭中央車站 / 市區自由", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80", desc: "米蘭下午自由散步、精品店逛街。" },
                    { type: "hotel", name: "住：米蘭飯店", desc: "連住 2 晚的第一晚。享受義式晚餐。", img: "https://images.unsplash.com/photo-1520175480921-4edfa0683001?auto=format&fit=crop&q=80" }
                ]},
                { day: 10, date: "3/27", weekday: "FRI", title: "Gornergrat ➔ 倒影湖", cards: [
                    { type: "hotel", name: "起點：策馬特飯店", desc: "準備欣賞馬特洪峰全貌。", img: "https://images.unsplash.com/photo-1533512930330-4ac257c86793?auto=format&fit=crop&q=80" },
                    { type: "transport", name: "登山齒軌火車", img: "https://images.unsplash.com/photo-1538330621152-478f3d057e90?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車 (GGB)", route: "Zermatt GGB ➔ Gornergrat", time: "35m"}
                    ], detail: "上山務必坐在車廂「右側」，風景才是馬特洪峰！" },
                    { type: "spot", name: "Riffelsee 倒影湖", img: "https://images.unsplash.com/photo-1518156677180-95a2893f3e9f?auto=format&fit=crop&q=80", desc: "Rotenboden 站下車走 10 分鐘即達，捕捉完美倒影。" },
                    { type: "transport", name: "返回小鎮", img: "https://images.unsplash.com/photo-1533512930330-4ac257c86793?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車", route: "返回策馬特小鎮", time: "30m"}
                    ], detail: "下山可以慢慢在鎮上選購紀念品。" },
                    { type: "hotel", name: "住：策馬特飯店", desc: "連住 5 晚。享受山城寧靜。", img: "https://images.unsplash.com/photo-1533512930330-4ac257c86793?auto=format&fit=crop&q=80" }
                ]},
                { day: 13, date: "3/30", weekday: "MON", title: "策馬特 ➔ 機場 ➔ 賦歸", cards: [
                    { type: "hotel", name: "退房：策馬特飯店", desc: "08:00 前出發，帶著滿滿照片回家。", img: "https://images.unsplash.com/photo-1533512930330-4ac257c86793?auto=format&fit=crop&q=80" },
                    { type: "transport", name: "前往蘇黎世機場路程", img: "https://images.unsplash.com/photo-1542296332-2e4473faf563?auto=format&fit=crop&q=80", steps: [
                        {mode: "火車", route: "Zermatt ➔ Visp ➔ Zurich Airport", time: "4hr"}
                    ], detail: "下午航班時間充裕，可在機場免稅店做最後補貨。" },
                    { type: "spot", name: "蘇黎世機場免稅區", img: "https://images.unsplash.com/photo-1542296332-2e4473faf563?auto=format&fit=crop&q=80", desc: "最後購買 Läderach 巧克力或紀念禮品。" },
                    { type: "hotel", name: "終點：桃園機場 (3/31)", desc: "16:10 抵達台灣。旅程圓滿結束。", img: "https://images.unsplash.com/photo-1542296332-2e4473faf563?auto=format&fit=crop&q=80" }
                ]}
            ]
        };

        let currentDay = 1;
        let isEditMode = false;
        let localData = null;

        const getTransportIcon = (mode) => {
            const m = mode.toLowerCase();
            if (m.includes('火車') || m.includes('train') || m.includes('ggb')) return '<i class="fas fa-train mr-4 text-blue-500 text-2xl"></i>';
            if (m.includes('纜車') || m.includes('cable') || m.includes('快線')) return '<i class="fas fa-cable-car mr-4 text-purple-500 text-2xl"></i>';
            if (m.includes('步行') || m.includes('走') || m.includes('健行')) return '<i class="fas fa-walking mr-4 text-emerald-500 text-2xl"></i>';
            if (m.includes('飛機') || m.includes('落地')) return '<i class="fas fa-plane mr-4 text-slate-400 text-2xl"></i>';
            if (m.includes('地鐵')) return '<i class="fas fa-subway mr-4 text-red-500 text-2xl"></i>';
            return '<i class="fas fa-chevron-right mr-4 text-slate-300 text-2xl"></i>';
        };

        const renderNavBar = () => {
            const navbar = document.getElementById('date-navbar');
            navbar.innerHTML = '';
            localData.days.sort((a,b) => a.day - b.day).forEach(item => {
                const btn = document.createElement('button');
                btn.className = `day-btn ${item.day === currentDay ? 'active' : ''}`;
                btn.onclick = () => { currentDay = item.day; renderContent(); };
                btn.innerHTML = `<span class="text-[14px] font-black text-slate-400 opacity-60 uppercase">Day</span>
                                 <span class="text-4xl font-serif italic leading-none my-1">${item.day}</span>
                                 <span class="text-[16px] font-bold opacity-80">${item.date}</span>`;
                navbar.appendChild(btn);
            });
        };

        const renderContent = () => {
            const data = localData.days.find(d => d.day === currentDay);
            const container = document.getElementById('itinerary-content');
            if(!data) return;

            let html = `
                <div class="mb-12 fade-in">
                    <p class="text-[18px] font-black text-slate-400 tracking-widest uppercase mb-1 italic">March ${data.date} (${data.weekday})</p>
                    ${isEditMode ? `<input type="text" value="${data.title}" id="day-title-input" class="text-3xl font-serif italic text-slate-700">` : `<h2 class="text-5xl font-serif italic text-slate-700 leading-tight">${data.title}</h2>`}
                </div>
            `;

            data.cards.forEach((card, idx) => {
                if (idx > 0) html += `<div class="arrow-divider"><i class="fas fa-chevron-down animate-bounce duration-[4000ms] text-slate-200"></i></div>`;
                
                if (card.type === 'hotel') {
                    html += `
                        <div class="card hotel-card shadow-lg p-10">
                            ${isEditMode ? `<input placeholder="圖片網址" value="${card.img}" onchange="updateCardField(${idx}, 'img', this.value)">` : `<div class="h-56 bg-slate-100 bg-cover bg-center rounded-3xl mb-6 shadow-inner" style="background-image: url('${card.img}')"></div>`}
                            <div class="flex items-center gap-4 mb-4"><i class="fas fa-house-chimney text-orange-400 text-2xl"></i><span class="text-[16px] font-black text-slate-400 uppercase tracking-widest">Base / Lodge</span></div>
                            ${isEditMode ? `<input value="${card.name}" onchange="updateCardField(${idx}, 'name', this.value)">` : `<h3 class="text-title text-slate-700 font-bold">${card.name}</h3>`}
                            ${isEditMode ? `<textarea onchange="updateCardField(${idx}, 'desc', this.value)">${card.desc}</textarea>` : `<p class="text-detail text-slate-400 mt-4 italic font-medium">${card.desc}</p>`}
                        </div>`;
                } else if (card.type === 'transport') {
                    html += `
                        <div class="card transport-card shadow-sm p-10">
                            ${isEditMode ? `<input placeholder="圖片網址" value="${card.img}" onchange="updateCardField(${idx}, 'img', this.value)">` : `<div class="h-56 bg-slate-100 bg-cover bg-center rounded-3xl mb-6 shadow-inner" style="background-image: url('${card.img}')"></div>`}
                            <div class="flex items-center gap-4 mb-8"><i class="fas fa-route text-blue-500 text-2xl"></i><span class="text-[16px] font-black text-slate-500 uppercase tracking-widest">Journey Log</span></div>
                            <div class="space-y-8 mb-8">
                                ${card.steps.map((s, sIdx) => `
                                    <div class="step-list-item">
                                        <div class="flex items-start">${getTransportIcon(s.mode)}
                                            <div>
                                                <p class="text-detail font-bold text-slate-700">${s.mode}: ${s.route}</p>
                                                <p class="text-[16px] text-slate-400 font-black mt-2">⏱️ ${s.time}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ${isEditMode ? `<textarea onchange="updateCardField(${idx}, 'detail', this.value)">${card.detail}</textarea>` : `<div class="bg-blue-50/70 p-6 rounded-3xl text-blue-700 italic font-bold text-detail border border-blue-100">${card.detail}</div>`}
                        </div>`;
                } else if (card.type === 'spot') {
                    html += `
                        <div class="card spot-card shadow-xl p-10">
                            ${isEditMode ? `<input placeholder="圖片網址" value="${card.img}" onchange="updateCardField(${idx}, 'img', this.value)">` : `<div class="h-80 bg-slate-100 bg-cover bg-center rounded-[2.5rem] mb-8 shadow-xl" style="background-image: url('${card.img}')"></div>`}
                            <div class="flex items-center gap-4 mb-6"><i class="fas fa-camera-retro text-orange-400 text-2xl"></i><span class="text-[16px] font-black text-slate-400 uppercase tracking-widest">Spotlight</span></div>
                            ${isEditMode ? `<input value="${card.name}" onchange="updateCardField(${idx}, 'name', this.value)">` : `<h3 class="text-4xl font-bold text-slate-700 serif tracking-tight">${card.name}</h3>`}
                            ${isEditMode ? `<textarea onchange="updateCardField(${idx}, 'desc', this.value)">${card.desc}</textarea>` : `<p class="text-detail text-slate-500 mt-6 leading-relaxed font-medium">${card.desc}</p>`}
                        </div>`;
                }
            });
            container.innerHTML = html;

            if(isEditMode) {
                document.getElementById('day-title-input').onchange = (e) => {
                    const day = localData.days.find(d => d.day === currentDay);
                    day.title = e.target.value;
                    document.getElementById('save-btn').classList.remove('hidden');
                };
            }
        };

        window.updateCardField = (idx, field, val) => {
            const day = localData.days.find(d => d.day === currentDay);
            day.cards[idx][field] = val;
            document.getElementById('save-btn').classList.remove('hidden');
        };

        document.getElementById('edit-toggle').onclick = () => {
            isEditMode = !isEditMode;
            document.getElementById('edit-toggle').classList.toggle('text-emerald-500');
            renderContent();
        };

        document.getElementById('save-btn').onclick = async () => {
            try {
                const docPath = doc(window.db, 'artifacts', window.appId, 'public', 'data', 'itinerary', 'master');
                await setDoc(docPath, localData);
                document.getElementById('save-btn').classList.add('hidden');
                isEditMode = false;
                renderContent();
            } catch (e) { console.error("Save Error:", e); }
        };

        const initData = () => {
            const docPath = doc(window.db, 'artifacts', window.appId, 'public', 'data', 'itinerary', 'master');
            onSnapshot(docPath, (doc) => {
                if (doc.exists()) {
                    localData = doc.data();
                } else {
                    localData = defaultTripData;
                }
                renderNavBar();
                renderContent();
            }, (err) => {
                localData = defaultTripData;
                renderNavBar();
                renderContent();
            });
        };

        setTimeout(initData, 1000);
    </script>

    <style> .fade-in { animation: fadeIn 0.8s ease-out; } @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } </style>
</body>
</html>